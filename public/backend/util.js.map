//Developed by Sy Le. Coprighted by Salesforce.com 2015
{"version":3,"sources":["util.js"],"names":[],"mappings":"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","file":"util.js","sourcesContent":["//external\nimport Mustache from 'mustache';\nimport fs from 'fs';\nimport path from 'path';\nimport _ from 'lodash';\nimport Q from 'q';\n\n//internal\nimport logger from './logger';//internal loggr\n\n//export\nconst self = {\n\t_getSimplePathString: (path) => {\n        var pathString = '';\n        try{\n            var pathSplits = path.split('/');\n            pathString = [pathSplits[pathSplits.length - 3], pathSplits[pathSplits.length - 1]].join('/');\n        }\n        catch(ex){}\n\n        return pathString;\n    },\n    getComponentNamesFromPath: function(path){\n        const shortenPath = self._getSimplePathString(path);\n\n        return [\n            shortenPath.substr(0, shortenPath.indexOf('/')),\n            shortenPath.substr(shortenPath.indexOf('/') + 1)\n        ]\n    },\n\tgetTemplateFunc: (templateStr) => {\n\t\treturn Mustache.render.bind(undefined, templateStr);\n\t},\n\treadFromFileAsync: (path) =>  {\n        const defer = Q.defer();\n\n        logger.debug(\n            'Reading file...'.magenta.bold,\n            self._getSimplePathString(path).yellow\n        );;\n\n        defer.resolve( fs.readFileSync(path, 'utf-8') );\n        return defer.promise;\n    },\n\tlistDir: function listDir(inputDir, inputRes) {\n        const defer = Q.defer();\n        const dirs = fs.readdirSync(inputDir);\n\n        //reduce and flatten out the dir\n        inputRes = _.reduce(dirs, (res, curDir) => {\n        \tconst newDir = path.join(inputDir, curDir);\n            if (fs.lstatSync(newDir).isDirectory()) {\n                listDir(newDir, res);\n            } else {\n                //if this dir contain /target/, then ignore it\n                if(newDir.indexOf('/target/') >= 0){\n                    return res;\n                }\n\n                //is a file\n                const extension = path.extname(newDir);\n                let destinationBucket;\n                switch (extension) {\n                    case '.cmp':\n                        destinationBucket = 'cmp';\n                        break;\n                    case '.app':\n                        destinationBucket = 'app';\n                        break;\n                    case '.evt':\n                        destinationBucket = 'evt';\n                        break;\n                    case '.js':\n                        destinationBucket = 'js';\n\n                        //special helper js\n                        if(newDir.indexOf('Helper.js') >= 0){\n                            destinationBucket = 'helperjs';\n                        }\n                        else if(newDir.indexOf('Controller.js') >= 0){\n                            destinationBucket = 'controllerjs';\n                        }\n                        else if(newDir.indexOf('Renderer.js') >= 0){\n                            destinationBucket = 'rendererjs';\n                        }\n                        break;\n                }\n\n                //push new dir to the right bucket\n                if(destinationBucket){\n                \tif (!res[destinationBucket]){\n                \t\t//defint it if it is not yet define\n                \t\tres[destinationBucket] = [];\n                \t}\n\n                \tres[destinationBucket].push(newDir);\n                }\n            }\n\n            return res;//return result\n        }, inputRes || {}//default reduce value\n            // app: [],\n            // cmp: [],\n            // evt: [],\n            // helperjs: [],\n            // controllerjs: [],\n            // rendererjs: [],\n            // js: []\n        );\n\n\t\t//use for the first call to return the promise\n        defer.resolve(inputRes);\n        return defer.promise;\n    },\n    getBaseFileNameWithoutExtension: (fileName) => {\n        var shortFileName = path.basename(fileName);\n        return shortFileName.substr(0, shortFileName.indexOf('.'));\n    },\n    getKeyValFromCheerioDom: (cheerioDom) => {\n        return [cheerioDom.attribs.name, cheerioDom.attribs];\n    },\n    writeToFile:(string, path, isAppend) => {\n        logger.debug(path.yellow);\n        if (isAppend === true){\n            fs.appendFileSync(path, string);\n        }\n        else{\n            fs.writeFileSync(path, string);\n        }\n    },\n    serializeJsonObject(jsonObj){\n        return JSON.stringify(jsonObj, null, 1);\n    },\n    //this method is used to filter out too common dependencies\n    //such as aura:registerEvent\n    isValidDependencies(componentFullName){\n        if(componentFullName.indexOf(':') >= 0){\n            //only consider tag with : (namespace:control)\n            return true;\n        }\n        return false;\n    },\n\n    /**\n     * @param  {[type]} usageMap     [description]\n     * @param  {[type]} parentName   [description]\n     * @param  {[type]} childrenName [description]\n     * @return the location in the map, this also initialize the map\n     * default state\n     */\n    getUsageMapByName(usageMap, parentName, childrenName){\n        usageMap[parentName] = usageMap[parentName] || {};\n        usageMap[parentName][childrenName] = usageMap[parentName][childrenName] || [];\n        return usageMap[parentName][childrenName];\n    },\n\n    /**\n     * @param  {[type]} curControlObj  [description]\n     * @param  {[type]} depdenciesName [description]\n     * @return the location in the map, this also initialize the map\n     * default state\n     */\n    getDependenciesPropInControlObj(curControlObj, depdenciesName){\n        curControlObj.dependencies[depdenciesName] = curControlObj.dependencies[depdenciesName] || [];\n        return curControlObj.dependencies[depdenciesName];\n    },\n\n    getNamespaceCountMapEntry(namespaceCountMap, controlNameSpace){\n        namespaceCountMap[controlNameSpace] = namespaceCountMap[controlNameSpace] || 0;\n        return namespaceCountMap[controlNameSpace];\n    },\n\n    getControlCountMapEntry(controlCountMap, depdenciesName){\n        controlCountMap[depdenciesName] = controlCountMap[depdenciesName] || 0;\n        return controlCountMap[depdenciesName];\n    },\n\n    getDependenciesMapEntry(dependenciesMap, controlNameSpace){\n        dependenciesMap[controlNameSpace] = dependenciesMap[controlNameSpace] || {};\n        return dependenciesMap[controlNameSpace];\n    }\n}\n\nexport default self;"],"sourceRoot":"/source/"}