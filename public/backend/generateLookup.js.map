//Developed by Sy Le. Coprighted by Salesforce.com 2015
{"version":3,"sources":["generateLookup.js"],"names":[],"mappings":"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","file":"generateLookup.js","sourcesContent":["//external\nimport cheerio from 'cheerio';\nimport path from 'path';\nimport colors from 'colors';\nimport _ from 'lodash';\nimport Q from 'q';\n\n\n//internal\nimport logger from './logger';\nimport util from './util';\n\n\n//exports\nexport default (componentFileNames, baseDirAuraUpstream, outputDirDataPath) => {\n\tconst promises = [];\n\n\tconst interestedFiles = _.merge(\n\t\t_.values(componentFileNames.cmp),\n\t\t_.values(componentFileNames.app)\n\t);\n\n\n\tconst dependenciesMap = {};//which component I use\n\t// {\n\t// \tnameSpace : {\n\t// \t\tcontrolName : {\n\t// \t\t\tattributes : {\n\t// \t\t\t\t...\n\t// \t\t\t\tattributeName1 : {name, type, default, description, access}\n\t// \t\t\t\t...\n\t// \t\t\t},\n\t// \t\t\timports    : {\n\t// \t\t\t\t...\n\t// \t\t\t\timportLibName1 : {library, property}\n\t// \t\t\t\t...\n\t// \t\t\t},\n\t// \t\t\tevents     : {\n\t// \t\t\t\t...\n\t// \t\t\t\teventName1 : {name, type, description}\n\t// \t\t\t\t...\n\t// \t\t\t},\n\t// \t\t\thandlers   : {\n\t// \t\t\t\t...\n\t// \t\t\t\thandlerName1 : {name, value, action}\n\t// \t\t\t\t...\n\t// \t\t\t},\n\t// \t\t\tmethods    : {\n\t// \t\t\t\t...\n\t// \t\t\t\tmethodName1  : {name, action, access, description}\n\t// \t\t\t\t...\n\t// \t\t\t}\n\t// \t\t} \n\t// \t}\n\t// }\n\t\n\tconst usageMap = {};//which component uses me\n\t\n\tconst namespaceCountMap = {};//count the important of namespace\n\t// {\n\t// \tui:stuff: [\n\t// \t\t{controlNameSpace, controlName, attribs}\n\t// \t]\n\t// }\n\t\n\n\tconst controlCountMap = {};//count how many a component is used\n\n\tconst controlLocationMap = {};//used for autocomplete\n\t//flat map of <namespace:control> : relative_location\n\n\n\t//loop through interested files\n\t_.each(\n\t\tinterestedFiles,\n\t\tfileName => {\n\t\t\tconst defer = Q.defer();\n\t        promises.push(defer.promise);\n\n\t        const [controlNameSpace, controlName] = util.getComponentNamesFromPath(fileName);\n\t        const controlFullName = `${controlNameSpace}:${controlName}`;\n\n\t        const curControlObj = {\n\t        \tattributes : {},\n\t\t\t\timports : {},\n\t\t\t\tevents : {},\n\t\t\t\thandlers : {},\n\t\t\t\tmethods : {},\n\t\t\t\tdependencies : {}\n\t        };\n\n\t        //increment namespace count map\n\t        util.addNamespaceCountMapEntry(namespaceCountMap,controlNameSpace, 1);\n\n\t        //update the dependencies stuffs\n\t        util.setDependenciesMapEntry(dependenciesMap, controlNameSpace, controlName, curControlObj);\n\n\t        //update it for autocomplete\n\t        let relativeControlPath = fileName.substr(fileName.indexOf('aura_upstream/'));//substring to aura_upstream\n\t        relativeControlPath = relativeControlPath.substr(0, relativeControlPath.lastIndexOf('/'));\n\t        controlLocationMap[controlFullName] = relativeControlPath;\n\n\t        //read and parse\n\t        util.readFromFileAsync(fileName).then( fileContent => {\n\t            //success\n\t            //parsing xml\n\t            const $ = cheerio.load(fileContent, {\n\t                xmlMode: true\n\t            });\n\n\n\t            _.each(\n\t            \t$('*'),\n\t            \t(attribute) => {\n\t            \t\tconst {name, attribs, children} = attribute;\n\n\n\t            \t\t//populate usage map\n\t            \t\tutil.appendUsageMapByName(\n\t            \t\t\tusageMap,\n\t            \t\t\tname,\n\t            \t\t\tcontrolFullName,\n\t            \t\t\t{\n\t\t            \t\t\tcontrolNameSpace,\n\t\t            \t\t\tcontrolName,\n\t\t            \t\t\tcontrolFullName,\n\t\t            \t\t\tattribs\n\t\t            \t\t}\n            \t\t\t)\n\n\t            \t\t//populate the use a ...\n\t            \t\tswitch(name.toLowerCase()){\n            \t\t\t\tcase 'aura:attribute'://{name, type, default, description, access}\n            \t\t\t\t\tconst [curAttrName, curAttrAttributes] = util.getKeyValFromCheerioDom(attribute);\n            \t\t\t\t\tcurControlObj.attributes[curAttrName] = curAttrAttributes;\n            \t\t\t\t\tbreak;\n\n        \t\t\t\t\tcase 'aura:import'://{library, property}\n        \t\t\t\t\t\tconst {library} = attribs;\n        \t\t\t\t\t\tcurControlObj.imports[library] = attribs;\n            \t\t\t\t\tbreak;\n\n        \t\t\t\t\tcase 'aura:registerevent'://{name, type, description}\n        \t\t\t\t\t\tconst eventName = attribs.name;\n        \t\t\t\t\t\tcurControlObj.events[eventName] = attribs;\n    \t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\tcase 'aura:handler'://{name, value, action}\n\t\t\t\t\t\t\t\tconst handlerName = attribs.name;\n        \t\t\t\t\t\tcurControlObj.handlers[handlerName] = attribs;\n    \t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\tcase 'aura:method'://{name, action, access, description}\n\t\t\t\t\t\t\t\tconst methodName = attribs.name;\n\n\t\t\t\t\t\t\t\tconst childrenAttrs = _.reduce(\n\t\t\t\t\t\t\t\t\tchildren || [],\n\t\t\t\t\t\t\t\t\t(resChildAttrs, curChildAttr) => {\n\t\t\t\t\t\t\t\t\t\tif (curChildAttr.name === 'aura:attribute' && attribs){\n    \t\t\t\t\t\t\t\t\t\tconst [childAttrName, childAttrAttributes] = util.getKeyValFromCheerioDom(curChildAttr);\n    \t\t\t\t\t\t\t\t\t\tresChildAttrs[childAttrName] = childAttrAttributes;\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\treturn resChildAttrs;\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t{}\n\t\t\t\t\t\t\t\t);\n\n\t\t\t\t\t\t\t\tcurControlObj.methods[methodName] = childrenAttrs;\n\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\tcase 'aura:component'://to ignore\n\t\t\t\t\t\t\t\tbreak;\n\n        \t\t\t\t\tdefault:\n        \t\t\t\t\t\t//other tag will be considered depdencies\n        \t\t\t\t\t\tconst depdenciesName = name;\n        \t\t\t\t\t\tif (util.isValidDependencies(depdenciesName)){\n            \t\t\t\t\t\t//list of depdencies\n        \t\t\t\t\t\t\tutill.appendDependenciesPropInControlObj(\n        \t\t\t\t\t\t\t\tcurControlObj,\n        \t\t\t\t\t\t\t\tdepdenciesName,\n        \t\t\t\t\t\t\t\tattribs\n    \t\t\t\t\t\t\t\t);\n\n            \t\t\t\t\t\t//count control usage\n            \t\t\t\t\t\tutil.addControlCountMapEntry(controlCountMap, depdenciesName, 1);\n            \t\t\t\t\t}\n        \t\t\t\t\t\tbreak;\n            \t\t\t}\n\t            \t}\n            \t);\n\n\t            //resolved\n\t            defer.resolve();\n\t        });\n\t\t}\n\t);\n\n\n\t//when all things are done, lets prepare to print\n\tQ.all(promises).then( () => {\n\t\tutil.writeToFile(\n            util.serializeJsonObject( dependenciesMap ),\n            path.join(\n                outputDirDataPath,\n                'dependenciesMap.json'\n            )\n        );\n\n        util.writeToFile(\n            util.serializeJsonObject( usageMap ),\n            path.join(\n                outputDirDataPath,\n                'usageMap.json'\n            )\n        );\n\n        util.writeToFile(\n            util.serializeJsonObject( namespaceCountMap ),\n            path.join(\n                outputDirDataPath,\n                'namespaceCountMap.json'\n            )\n        );\n\n\n\n        const remappedControlCountMap = _.reduce(\n        \tcontrolCountMap,\n        \t(res, controlReferencesCount, controlName) => {\n        \t\tconst fullControlName = controlCountMap[`${controlName}.app`]\n        \t\t\t? `${controlName}.app`\n        \t\t\t: `${controlName}.cmp`;\n        \t\tres[fullControlName] = controlReferencesCount;\n\n        \t\treturn res;\n        \t},\n        \t{}\n    \t);\n\n        //let's do a map to get the name\n        util.writeToFile(\n            util.serializeJsonObject( remappedControlCountMap ),\n            path.join(\n                outputDirDataPath,\n                'controlCountMap.json'\n            )\n        );\n\n\n\n        util.writeToFile(\n            util.serializeJsonObject( _.keys(controlLocationMap) ),\n            path.join(\n                outputDirDataPath,\n                'autoCompleteControlMap.json'\n            )\n        );\n\n\n        util.writeToFile(\n            util.serializeJsonObject( controlLocationMap ),\n            path.join(\n                outputDirDataPath,\n                'controlLocationMap.json'\n            )\n        );\n\n\n        //write the aura_upstream_pom\n        util.readFromFileAsync(path.join(baseDirAuraUpstream,'pom.xml'))\n        .done( fileContent => {\n        \tutil.writeToFile(\n\t        \tfileContent,\n\t        \tpath.join(\n\t                outputDirDataPath,\n\t                'aura_upstream_pom.xml'\n\t            )\n\t        );\n        });\n\t});\n};"],"sourceRoot":"/source/"}